(()=>{function k(n,t=5,e=null,o=null,r=Math.max(navigator.hardwareConcurrency/2,1)){return console.debug("fast algo"),new Promise((a,s)=>{let d=URL.createObjectURL(new Blob(["(",j(),")()"],{type:"application/javascript"})),i=[],c=!1,u=()=>{c||(c=!0,i.forEach(l=>l.terminate()),e?.removeEventListener("abort",m),URL.revokeObjectURL(d))},m=()=>{console.log("PoW aborted"),u(),s(new DOMException("Aborted","AbortError"))};if(e!=null){if(e.aborted)return m();e.addEventListener("abort",m,{once:!0})}for(let l=0;l<r;l++){let p=new Worker(d);p.onmessage=b=>{typeof b.data=="number"?o?.(b.data):(u(),a(b.data))},p.onerror=b=>{u(),s(b)},p.postMessage({data:n,difficulty:t,nonce:l,threads:r}),i.push(p)}})}function j(){return function(){let n=e=>{let o=new TextEncoder().encode(e);return crypto.subtle.digest("SHA-256",o.buffer)};function t(e){return Array.from(e).map(o=>o.toString(16).padStart(2,"0")).join("")}addEventListener("message",async e=>{let o=e.data.data,r=e.data.difficulty,a,s=e.data.nonce,d=e.data.threads,i=s,c=0;for(;;){let u=await n(o+s),m=new Uint8Array(u),l=!0;for(let p=0;p<r;p++){let b=Math.floor(p/2),M=p%2;if((m[b]>>(M===0?4:0)&15)!==0){l=!1;break}}if(l){a=t(m),console.log(a);break}s+=d,i==0&&c===1024&&(postMessage(s),c=0),c++}postMessage({hash:a,data:o,difficulty:r,nonce:s})})}.toString()}function v(n,t=5,e=null,o=null,r=1){return console.debug("slow algo"),new Promise((a,s)=>{let d=URL.createObjectURL(new Blob(["(",C(),")()"],{type:"application/javascript"})),i=new Worker(d),c=!1,u=()=>{c||(c=!0,i.terminate(),e?.removeEventListener("abort",m),URL.revokeObjectURL(d))},m=()=>{console.log("PoW aborted"),u(),s(new DOMException("Aborted","AbortError"))};if(e!=null){if(e.aborted)return m();e.addEventListener("abort",m,{once:!0})}i.onmessage=l=>{typeof l.data=="number"?o?.(l.data):(u(),a(l.data))},i.onerror=l=>{u(),s(l)},i.postMessage({data:n,difficulty:t})})}function C(){return function(){let n=t=>{let e=new TextEncoder().encode(t);return crypto.subtle.digest("SHA-256",e.buffer).then(o=>Array.from(new Uint8Array(o)).map(r=>r.toString(16).padStart(2,"0")).join(""))};addEventListener("message",async t=>{let e=t.data.data,o=t.data.difficulty,r,a=0;do(a&1023)===0&&postMessage(a),r=await n(e+a++);while(r.substring(0,o)!==Array(o+1).join("0"));a-=1,postMessage({hash:r,data:e,difficulty:o,nonce:a})})}.toString()}var O=4,H={fast:k,slow:v},g=document.getElementById("status"),A=document.getElementById("difficulty-input"),T=document.getElementById("algorithm-select"),x=document.getElementById("compare-select"),S=document.getElementById("table-header"),U=document.getElementById("table-header-compare"),f=document.getElementById("results"),N=()=>{A.value=O;for(let n of Object.keys(H)){let t=document.createElement("option");T.append(t);let e=document.createElement("option");x.append(e),t.value=t.innerText=e.value=e.innerText=n}},I=async(n,t,e,o)=>{if(!(t>=1))throw new Error(`Invalid difficulty: ${t}`);let r=H[e];if(r==null)throw new Error(`Unknown algorithm: ${e}`);let a=new Uint8Array(32);crypto.getRandomValues(a);let s=Array.from(a).map(m=>m.toString(16).padStart(2,"0")).join(""),d=performance.now(),{hash:i,nonce:c}=await r(s,Number(t),o),u=performance.now();return console.log({hash:i,nonce:c}),n.time+=u-d,n.iters+=c,{time:u-d,nonce:c}},h={time:0,iters:0},y={time:0,iters:0},R=()=>{let n=h.iters/h.time,t=y.iters/y.time;if(Number.isFinite(n)){if(g.innerText=`Average hashrate: ${n.toFixed(3)}kH/s`,Number.isFinite(t)){let e=(n-t)/n*100;g.innerText+=` vs ${t.toFixed(3)}kH/s (${e.toFixed(2)}% change)`}}else g.innerText="Benchmarking..."},w=n=>{let t=document.createElement("td");return t.innerText=n,t.style.padding="0 0.25rem",t},B=async n=>{let t=A.value,e=T.value,o=x.value;R();try{let{time:r,nonce:a}=await I(h,t,e,n.signal),s=document.createElement("tr");s.style.display="contents",s.append(w(`${r}ms`),w(a));let d=f.scrollHeight-f.clientHeight<=f.scrollTop;if(f.append(s),d&&(f.scrollTop=f.scrollHeight-f.clientHeight),R(),o!=="NONE"){let{time:i,nonce:c}=await I(y,t,o,n.signal);s.append(w(`${i}ms`),w(c))}}catch(r){r!==!1&&(g.innerText=r);return}await B(n)},E=null,L=()=>{h.time=h.iters=0,y.time=y.iters=0,f.innerHTML=g.innerText="";let n=f.parentElement;x.value!=="NONE"?(n.style.gridTemplateColumns="repeat(4,auto)",S.style.display="none",U.style.display="contents"):(n.style.gridTemplateColumns="repeat(2,auto)",S.style.display="contents",U.style.display="none"),E?.abort(),E=new AbortController,B(E)};N();A.addEventListener("change",L);T.addEventListener("change",L);x.addEventListener("change",L);L();})();
//# sourceMappingURL=bench.mjs.map
